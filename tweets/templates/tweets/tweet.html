<div id="tweet_box_{{ tweet.id }}" class="claim_box" style="padding: 10px;">
    <blockquote class="twitter-tweet" data-lang="en">
        <a href="{{ tweet.tweet_link }}"></a>
    </blockquote>
    {% if request.user.is_authenticated %}
        {% if request.user.id not in claim.users_commented_ids %}
            <button id="{{ tweet.id }}_add_comment_on_tweet" type="submit" class="btn btn-info">Use as comment reference</button>
        {% endif %}
        {% if request.user.is_superuser %}
            <button id="{{ tweet.id }}_tweet_delete" type="submit" class="btn btn-danger">Delete</button>
            <p id="error_msg_{{ tweet.id }}_tweet_delete" class="action_msg error_msg" hidden></p>
        {% endif %}
    {% endif %}
</div>

<script>
    $("#{{ tweet.id }}_add_comment_on_tweet").click(function(e){
        document.getElementById("{{ claim.id }}_new_comment_url").value = '{{ tweet.tweet_link }}';
        $('html, body').animate({
            scrollTop: $("#{{ claim.id }}_new_comment_url").offset().top
        }, 0);
    });

    $("#{{ tweet.id }}_tweet_delete").click(function(e){
        if (confirm('Are you sure you want to delete this tweet?')){
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: "{% url 'tweets:delete_tweet' %}",
                headers: { "X-CSRFToken": getCookie('csrftoken') },
                data: {
                    tweet_id: '{{ tweet.id }}',
                },
                success: function (page) {
                    window.location.reload();
                },
                error: function (error) {
                    let err = error.responseText.split('\n')[1];
                    document.getElementById("error_msg_{{ tweet.id }}_tweet_delete").innerHTML =
                        'Error: <br>' + err;
                    $("#error_msg_{{ tweet.id }}_tweet_delete").attr("hidden", false);
                }
            });
        }
    });
</script>
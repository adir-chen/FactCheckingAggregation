{#title=comment.title#}
{#user_id = comment.user_id#}
{#claim_id =comment.claim_id #}
{#title =comment.title #}
{#description = comment.description #}
{#url = comment.url #}
{#verdict_date =comment.verdict_date #}
{#tags = comment.tags #}
{#label = comment.label #}
{#pos_votes = comment.pos_votes #}
{#neg_votes = comment.neg_votes#}
{%  load mathfilters %}

<div style="margin: auto;">
    <div class="claim_box" style="padding: 20px; width: 100%;">
        <table id="comment" style="width: 100%">
            <tr>
                <td class="left" style="width: 100%"><h4><b>{{ comment.title }}</b></h4></td>
                <td class="right">User: <a href="#">{{ user.username }}</a></td>
            </tr>
            <tr>
                <td class="left"><p>{{ comment.description }}</p></td>
                <td class="right"><p>
                    <img src="{{ user.user_img }}" style="max-height: 90px; max-width: 90px;"><br>
                    {% load static %}
                    {%  if comment.label == "TRUE" %}
                        <img style="max-width: 70px;" src="{% static 'claims/assets/images/TrueLabel.png' %}" >
                    {% else %}
                        <img style="max-width: 70px; " src="{% static 'claims/assets/images/FalseLabel.png' %}" >
                    {%  endif %}
                </p></td>
            </tr>
            <tr>
                <td class="left">References: <a href={{ comment.url }}>website</a></td>
                <td class="right" style="text-align: center;">
                    <div style="margin: auto;">
                        {% if request.user.is_authenticated %}
                            <button id="{{ comment.id }}_arrow_up" type="submit" class="arrow_up" style="">▲</button>
                        {% endif %}
                        <br>
                        <span id="{{ comment.id }}_voteCount" style="text-align: center; color: #000;">{{ comment.up_votes.count|sub:comment.down_votes.count }}</span>
                        <br>
                        {% if request.user.is_authenticated %}
                            <button id="{{ comment.id }}_arrow_down" type="submit" class="arrow_down">▼</button>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>l
<script>
    let up_voted_{{ comment.id }} = false;
    let down_voted_{{ comment.id }} = false;
    let up_count_{{ comment.id }} = {{ comment.up_votes.count }};
    let down_count_{{ comment.id }} = {{ comment.down_votes.count }};

    $(document).ready(function () {
        {% for voted_user in comment.up_votes.all %}
            {% if request.user.id == voted_user.id %}
                up_voted_{{ comment.id }} = true;
                document.getElementById("{{ comment.id }}_arrow_up").style.color = "#555";
            {% endif %}
        {% endfor %}
        {% for voted_user in comment.down_votes.all %}
            {% if request.user.id == voted_user.id %}
                down_voted_{{ comment.id }} = true;
                document.getElementById("{{ comment.id }}_arrow_down").style.color = "#555";
            {% endif %}
        {% endfor %}
    });

    $("#{{ comment.id }}_arrow_up").click(function(e){
        e.preventDefault();
        $.ajax({
            type: 'GET',
            url: "{% url 'comments:up_vote' %}",
            data: {
                comment_id: '{{ comment.id }}',
                user_id: '{{ request.user.id }}'
            },
            success: function () {
                if(!up_voted_{{ comment.id }}) {
                    up_voted_{{ comment.id }} = true;
                    up_count_{{ comment.id }}++;
                    document.getElementById("{{ comment.id }}_arrow_up").style.color = "#555";
                    if(down_voted_{{ comment.id }}) {
                        down_count_{{ comment.id }}--;
                        down_voted_{{ comment.id }} = false;
                        document.getElementById("{{ comment.id }}_arrow_down").style.color = "#C0C0C0";
                    }
                }
                else{
                    up_voted_{{ comment.id }} = false;
                    up_count_{{ comment.id }}--;
                    document.getElementById("{{ comment.id }}_arrow_up").style.color = "#C0C0C0";
                }
                $("#{{ comment.id }}_voteCount").text(up_count_{{ comment.id }}-down_count_{{ comment.id }});
            },
            error: function (error) {
                console.log(error);
            }
        });
    });
    $("#{{ comment.id }}_arrow_down").click(function(e){
        e.preventDefault();
        $.ajax({
            type: 'GET',
            url: "{% url 'comments:down_vote' %}",
            data: {
                comment_id: '{{ comment.id }}',
                user_id: '{{ request.user.id }}'
            },
            success: function () {
                if(!down_voted_{{ comment.id }}) {
                    down_voted_{{ comment.id }} = true;
                    down_count_{{ comment.id }}++;
                    document.getElementById("{{ comment.id }}_arrow_down").style.color = "#555";
                    if(up_voted_{{ comment.id }}) {
                        up_count_{{ comment.id }}--;
                        up_voted_{{ comment.id }} = false;
                        document.getElementById("{{ comment.id }}_arrow_up").style.color = "#C0C0C0";
                    }
                }
                else{
                    down_voted_{{ comment.id }} = false;
                    down_count_{{ comment.id }}--;
                    document.getElementById("{{ comment.id }}_arrow_down").style.color = "#C0C0C0";
                }
                $("#{{ comment.id }}_voteCount").text(up_count_{{ comment.id }}-down_count_{{ comment.id }});
            },
            error: function (error) {
                console.log(error);
            }
        });
    });
</script>
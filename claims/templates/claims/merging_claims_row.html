<tr class="merging_suggestions_table">
    <td><div style="padding-bottom: 20px">{{ suggestion.claim.claim }}</div><br>
        <div style="position: absolute; bottom: 0px;">
            <a target="_blank" href="/claim/{{ suggestion.claim.id }}">Link to claim</a>
        </div>
    </td>
    <td><div style="padding-bottom: 20px">{{ suggestion.claim_to_merge.claim }}</div><br>
        <div style="position: absolute; bottom: 0px;">
            <a target="_blank" href="/claim/{{ suggestion.claim_to_merge.id }}">Link to claim</a>
        </div>
    </td>
    <td>
        <button id="{{ suggestion.claim.id }}_{{ suggestion.claim_to_merge.id }}_merging_claims" type="submit" class="btn btn-info">Merge claims</button>
        <br><br>
        <button id="{{ suggestion.claim.id }}_{{ suggestion.claim_to_merge.id }}_delete" type="submit" class="btn btn-danger">Delete suggestion</button>
    </td>
</tr>

<script>
    if(localStorage.getItem("success_msg_merging_claims")){
        $("#success_msg_merging_claims").attr("hidden", false);
        localStorage.clear();
    }
    else if(localStorage.getItem("success_msg_deleting_suggestion")){
        $("#success_msg_deleting_suggestion").attr("hidden", false);
        localStorage.clear();
    }

    $("#{{ suggestion.claim.id }}_{{ suggestion.claim_to_merge.id }}_merging_claims").click(function(){
        $.ajax({
            type: 'POST',
            url: "{% url 'claims:merging_claims' %}",
            headers: { "X-CSRFToken": getCookie('csrftoken') },
            data: {
                claim_id: '{{ suggestion.claim.id }}',
                claim_id_to_merge: '{{ suggestion.claim_to_merge.id }}',
            },
            success: function () {
                localStorage.setItem("success_msg_merging_claims", true);
                window.location.reload();
            },
            error: function (request) {
                hide_all_msgs();
                let err = request.responseJSON;
                document.getElementById("error_msg_merging_claims").innerHTML =
                'Error: <br>' + err;
                $("#error_msg_merging_claims").attr("hidden", false);
            }
        });
    });

    $("#{{ suggestion.claim.id }}_{{ suggestion.claim_to_merge.id }}_delete").click(function(e){
        if (confirm('Are you sure that you want to delete this suggestion?')){
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: "{% url 'claims:delete_suggestion_for_merging_claims' %}",
                headers: { "X-CSRFToken": getCookie('csrftoken') },
            data: {
                claim_id: '{{ suggestion.claim.id }}',
                claim_id_to_merge: '{{ suggestion.claim_to_merge.id }}',
            },
                success: function () {
                    localStorage.setItem("success_msg_deleting_suggestion", true);
                    window.location.reload();
                },
                error: function (request) {
                    hide_all_msgs();
                    let err = request.responseJSON;
                    document.getElementById("error_msg_deleting_suggestion").innerHTML =
                    'Error: <br>' + err;
                    $("#error_msg_deleting_suggestion").attr("hidden", false);
                }
            });
        }
    });

    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) c_end = document.cookie.length;
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }
</script>
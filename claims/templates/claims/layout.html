<!DOCTYPE html>
<html lang="en">
<script async src="https://app.appzi.io/bootstrap/bundle.js?token=VUDam"></script>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="{% block meta_title %} {% endblock %}">
    <meta name="description" content="{% block meta_description %} {% endblock %}">
    <meta name="src" content="{% block meta_src %} {% endblock %}">

    <title>
        {% block claim_head_title %}
        {% endblock %}
    </title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/css/bootstrap.min.css" integrity="sha384-PDle/QlgIONtM1aqA2Qemk5gPOE7wFq8+Em+G/hmo5Iq0CCmYZLv3fVRDJ4MMwEA" crossorigin="anonymous">
    {% load static %}
    <link rel="icon" href="{% static 'claims/assets/images/favicon.png' %}">
    <link href="{% static 'claims/style.css' %}" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137817705-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-137817705-1');
    </script>
    <script>
        function my_special_notification_callback(data) {
            var list = document.getElementById("live_notifications_list");
            while (list.hasChildNodes()) {
              list.removeChild(list.firstChild);
            }
            if (data.unread_list.length > 0){
                $("#notify_badge").attr("hidden", false);
                $("#mark_all").attr("hidden", false);
            }
            else{
                $("#notify_badge").attr("hidden", true);
                $("#mark_all").attr("hidden", true);
            }
            for (var i=0; i < data.unread_list.length; i++) {
                var element = document.createElement('li');
                var actor = data.unread_list[i].actor;
                var verb = data.unread_list[i].verb;
                var target_id = data.unread_list[i].target_object_id;
                element.innerHTML = "<a href ='#' onclick='read_notification(" + JSON.stringify(data.unread_list[i]) + ")'" + target_id + "'>" + actor + " " + verb + "</a>";
                list.appendChild(element);
            }
        }
    </script>
    {% load notifications_tags %}
    <script src="{% static 'notifications/notify.js' %}" type="text/javascript"></script>
    {% register_notify_callbacks callbacks='fill_notification_badge,my_special_notification_callback' %}
</head>
<body>
    <header id="header">
        <div id="header-wrapper">
            <div class="site-logo">
                <a href="/"><img src="{% static 'claims/assets/images/site_logo.png' %}"></a><br>
                <h6><i>Rate the Facts</i></h6>
            </div>
            <div class="header-tools">
                {% if request.user.is_authenticated %}
                    <p>
                        <span style="font-weight: bold;">Welcome </span><a href="/users/{{ request.user.id }}">{{request.user.username}}</a>
                        <a href="#" class="notification" onclick="showNotifiactions()">
                            <span><i class="fa fa-bell" style="margin-left: 10px;"></i></span>
                            <span id="notify_badge" class="badge" hidden="hidden">{% live_notify_badge %}</span>
                        </a> <span style="font-size: 14px;">Notifications</span>
                    </p>
                    <div id="last-notifications" class="last-notifications">
                        <div id="mark_all" style="background: #eee; padding: 10px; margin: 0;" hidden="hidden">
                            <a href="/users/read_all_notifications">Mark all as read</a>
                            <button onclick="showNotifiactions()" style="border: 1px solid #ccc; background: none; float: right;">X</button>
                        </div>
                        <div>
                            <ul id="live_notifications_list" style="margin: 0;">
                            </ul>
                        </div>
                        <div style="background: #eee; padding: 10px;">
                            <a href="/users/notifications">See all notifications</a>
                        </div>
                    </div>
                    <a href="/logout" style="font-size: 14px;">Sign Out</a>
                {% else %}
                    <p>Welcome guest.</p>
                    <h6><i>Want to share information with us?</i></h6>
                    <p>
                        <ul>
                            <p>Sign in with:</p>
                            <li><div style="display: inline-block"><img src="{% static 'claims/assets/images/google_icon.jpg' %}" style="padding: 0; margin: 0;"><a href="{% url 'social:begin' 'google-oauth2' %}"> Google</a></div></li>
                            <li><div style="display: inline-block"><img src="{% static 'claims/assets/images/twitter_icon.png' %}"><a href="{% url 'social:begin' 'twitter' %}"> Twitter</a></div></li>
                            <li><div style="display: inline-block"><img src="{% static 'claims/assets/images/facebook_icon.png' %}"><a href="{% url 'social:begin' 'facebook' %}"> Facebook</a></div></li>
                        </ul>
                    </p>
                {% endif %}
                <form class="search-container" action={% url 'search:search_result' %}>
                    <div class="searchbar">
                        <input type="text" placeholder="Search.." name="search_keywords" value="{{ request.GET.search_keywords }}">
                    </div>
                    <div class="searchbutton">
                        <button type="submit"><i class="fa fa-search"></i></button>
                    </div>
                </form>
            </div>
        </div>
    </header>
    <div class="topnav">
        <div class="nav-wrapper" id="myTopnav">
            <a href="/">Home</a>
            <a href="/about">About us</a>
            <a href="/contact_us/contact_us_page">Contact us</a>
            {% if request.user.is_authenticated %}
                <a href="/add_claim_page">Add new claim</a>
                <a href="/users/{{ request.user.id }}">My profile</a>
            {% endif %}
            {% if request.user.is_superuser %}
                <div class="dropdown">
                    <a class="dropdown-toggle">Admin tools</a>
                    <div class="dropdown-content">
                        <a href="/admin" target="_blank">Admin panel</a>
{#                        <a href="/users/add_all_scrapers">Add all scrapers</a>#}
                        <a href="/users/add_scraper_guide">Adding a scraper guide</a>
                        <a href="/export_claims_page">Export claims as csv</a>
                        <a href="/tweets/export_tweets_page">Export tweets as csv</a>
                        <a href="/post_claims_tweets_page">Import claims/tweets from csv</a>
                        <a href="/merging_claims_page">Merging claims suggestions</a>
                        <a href="/logger/view_log">Logger</a>
                        <a href="/analytics/" style="border-right: 0;">View analytics</a>
                    </div>
                </div>
            {% endif %}
        </div>
        <a href="javascript:void(0);" class="nav-hamburger-icon" onclick="navFunc()"><i class="fa fa-bars"></i></a>
    </div>
    <div>
    <section id="page_content">
    {% block page_content %}

    {% endblock %}
    </section>
    <footer id="footer">
        &copy; 2018-2019 WTFacts version 1.0
    </footer>

    <script>
        function navFunc(){
            var x = document.getElementById("myTopnav");
            if (x.className === "topnav") {
                x.className += " responsive";
            } else {
                x.className = "topnav";
            }
        }

        function showNotifiactions() {
          var x = document.getElementById("last-notifications");
          if (x.style.display === "none") {
            x.style.display = "block";
          } else {
            x.style.display = "none";
          }
        }

        $(document).mouseup(function(e)
        {
            var container = $("#last-notifications");
            if (!container.is(e.target) && container.has(e.target).length === 0)
            {
                container.hide();
            }
        });

        function read_notification(notification) {
            $.ajax({
                type: 'POST',
                url: "{% url 'users:read_notification' %}",
                headers: { "X-CSRFToken": getCookie('csrftoken') },
                data: {
                    notification_id: notification.id,
                },
                success: function () {
                    window.location.pathname = '/claim/' + notification.target_object_id;
                },
            });
        }
        function getCookie(c_name) {
            if (document.cookie.length > 0) {
                c_start = document.cookie.indexOf(c_name + "=");
                if (c_start != -1) {
                    c_start = c_start + c_name.length + 1;
                    c_end = document.cookie.indexOf(";", c_start);
                    if (c_end == -1) c_end = document.cookie.length;
                    return unescape(document.cookie.substring(c_start, c_end));
                }
            }
            return "";
        }

        // {#grecaptcha.ready(function() {#}
        // {# for grecaptcha v3 #}
        // {#    grecaptcha.execute('6LftCZsUAAAAAKmuIi7qSDZTr1enYj2gjsk_3c0c', {action: 'botsChecking'}).then(function (token) {#}
        // {#        console.log(token);#}
        // {#        document.getElementById('g-recaptcha-response').value = token;#}
        // {#    });#}
        // {#});#}
    </script>

</body>
</html>